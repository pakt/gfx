
function initialize_compressor() {
	compressor=new LZMA( "js/lzma_worker.js" );
	return compressor;
}

function initialize_helper() {
}

function load_url_code() {
	if ( window.location.hash ) {

		var hash = window.location.hash.substr( 1 );
		var version = hash.substr( 0, 2 );

		if ( version == 'A/' ) {

			// LZMA

			readURL( hash.substr( 2 ) );

		} else {

			// Basic format

			code.value = decodeURIComponent( hash );

		}

	} else {

		readURL('5d00000100331f0000000000000017e07ce86833f10491cddf1cc6c2b924afc0179f8b072eda9c1f02598c31492cbedcbcb6b5f0a6b4297a7464448b0e69286850ec100b1e135eb081874c9236a25975205cdadab28bd1d003cf4b9b8c129c6dba86531691dd454b0af5f989e7c97c612d53a9ebc2bd696e6686a801a85d11305952bee9adb2dba37521b0e3d86c19293a38d5450d434e3f920a47fce91be75be5ed8f482a64d7da7ad6240fb6069b8c1274f98dc5229452cf368ff677830a94dd3f4037c2f2f08cf24cccd08aec04e2c858095b9e4ad9f7fad0fac1543d64eb291483399d45a803c2eccec2c0f32c3929beec3e918e3b4acc5589aebfc1244f76517cfa106cdb48b3cd978ec41c20e62a5de0f1807ed9cafb42034ce289120100ab0c42732f1c853f9ad9a7a84f0d6cf2d1785b817cfad3019dd3fdbf3eae592060b157fc6b3266d92675249cf2295ec881969bbaa4cba87024fb6662aec1c94d00f75a7f1de7ebb3b0a1fa24930f042cb86a3dff1afcd1c4effe2b148de2bfc84740f422f68d0bd335d744bc73b535bbc9c4cffd2dfcdd9a3e3bcb5e627c3ac9e86761e9844d3544dd4cc8fb124390c2190f7d9d2c455606d3e9fceeec3ef2e7cfc4b6bdab4bf1d613b9112e74832806846f9122f0315794c2daebc9fdfdd7f38eadebf07a4df995388b621703b40559f7616b5de2f618ba00ede5f481e7483a9c9c6d05ea0d2862fb6f74241331ab2e8268be8d2ecb9700e2d3e7480f8c41409bab042fcd06217e95a92ca25fbb6014077f71040d31d4155beb963412fdc7970c982a2095a588bb03877b54af090a0016cd0c4d88e43a7a96fd5be1dcca4bef04c4e9d7a055ec51b5b185d9e939abb4aaf350fd53b677843997cac493fef0ad64469a476538bcf3dcdcee5ef8acb57b27d20b35e7b25b10ce6e8a1f76769b4859f646e6869d7d2d2144f11512ef2fd4e37874d917fa751cf0953e1eb4f428b731eb5b2e9486e426cd33ff00dcca630d3f76bde0208fa2d3c96c8170bf86f12d53441bd47531567a1f3ea58fc8600a254e9a6ae5c7bf103a4bb5d2b591db53de9a7c9c11f8d8f5986fa092d9ccfffe5781eed182e9e14ff6036dacd4399372150743a574866c7c3b4577636983927d04ae7600cc8784bf6a11f85ea5da372a5698f8b41900d5b75a3a727487d1bcf9061bbf4f86df20fefd9adc1df7046fe6f5588f6fcdedf94c6f4ff4e16d2681f11aebb9ef1c1331f02ad0394e7d97675e7b9b7aeec87bc1cd649ff07db6d7151ea7d318453c043c0fd652b3a7eb220a234f82c06cc12ef6795368278b47b5b000af38509f1f434787a916cf2fefb58aa4da9f17d5d4934c2c92e340da26b367ac96096453129b9f291eca262208d26e8e54af0379077e10de786eaaa19cb252d1d62de9c4ddfeef3b5b07107948384cc4b04a57ec5203de8bb8f1b3df9c8151a93bf0c3b0b0f727162d023b5c74d6ce5dbc1cf59be0474eb42d772775511c477623e62dd2f894e9a7e84c62f6ea611439723581b33ea2c4761d1df672a4cf5b01bd9375623916135c5bef407e360eeef3a3b405f6f43d12ec660425e4c04c5ff7b408178bae436ce0dd669dd927bfe0547d6479c49caf8aca9c994916681e61eb97fb7b4f4a55ce8b4128de2520cc0134fa16abcbf7a46700a6e035fd2847229eb65c6e0f9bab40ab410ab9cd47522aa67365d366537a37f153dfca5bb8d4558586be893256bbbebeedc86fd4d22472f9ef630e7c64a1270e5f4ef294ed7f42dec1e52c396657e2f8bbac7581cc670c9d148c7383c3118f87a511011125bfe2fa609ee90ed3680ba160c2e07ee305aeda5a6835cecb8ce2a06e14594a8d5500afca641f9d35edd34b7b8261a456ad0cfd42f5e5307772f30d1f0cd77a0c98a005ec3c977870d8c90ff30c33c3c4e8470f896447cffa3140258ab3e133f407eebd9ae73288b81a30555b83452b64859d0f997d9279a3f29cbcf3e81eac9ddc6cfc8c80cd5580e1ca7517d689c33ff82927cfc071be66c6d7b64d7e792ca54cfa04da236e08b2e8746f6b66fdadba11dfac17c33dc6257ee2d272e5be35ae2d4ae4f93bfd7700e78ab7ec0c79290af74da637e9f5078f6d9d022e8ae019a0d96447d8839fa7ead3a9e31087798cc4e1dd7e028d858f5ce6fd2f0b48044bdce24775abf8fea2b5396cf30e9ceb238f5e301dabad573bd98d8eacd3a1c65631c7655fa7cde859e614fafef20cfc938101493b0fd3e5c4b471c6ace75f1a469dd949d88b494f1c5bb9257eff1a44416256a3160cfd2ee2ed61b9c0f848aa349834b1a2eaa77fd7dcf269d0d55ba9945b420bb2f5385d576c6d0a96e67206509b30ebacae955679d02faf71222e2c350c6ead57e47bf11ee4ecff0f931ddf7af6d07f6dcd93a43ebe401c098bb89a814f15fedb164a30a581d5b9229fdeeb71453108ead3a97ab98b819bcaba642976c7513d240aea8fb28a9ef75e85eda4574f7274cac135ed167867691fa5733393d8257610c2bdf5ae3f883ff038fbcba914625fd7a564d69efab51d6d3e8ca18771d1567dc9a7e12cd6d5dff6749f08f75e6d3e21b502320d7813e85a5089cbcf0d92b93c4e9a7934fbf8a832eed753c6f445050d6eb141e22d983c2dd6dc5551a72f435e95b2379443cff37b3cd8333b1d730f1a1d0fe3283625e2d46ba0a340a70e154c381efec21489751a20431d36f1ee5460097db7583db9b6c32f366d740aaf835c3a446a38fc60dcf87bf3ebef516a835ec5ba267d95b60c32d1ae6d4d5b28bcf54b160086b11f6881b2cd6086257b13ceb6c125c842c5312766d45a673fe4db659aa0e62c74113ccd86e13e385b7826794df77fa5577244e9afcd0f2599407e2411ae1e3e931a045e29a39d167e0ad33b41db1f31b541996fb47717bc3a2b136e3a9fadff56ec6af279823f6b185c4e5db011a3d8742b018b80daa3648cc9f1f48001c1a020fcb696ed0404a7da519809cb67d7605ae7a9bc895032e3f93eb7122d41f47621c48d0c2d9ce2b0aa0ffa6fe8a6847c760279bc0f63a15e961ab4efe79b4595062abc32d55c7e97fcbdf7b16683f6333db72ccc609e095e053b002ce5ef856231f5be5db79f1afdc670dfa825eac2b1f3d5f231a289affd5ed4f26dd8073c9691430f57ae2abcb90f6388f183f794e299b3a52a4871e1c220ad37197a1334d9265916710258624ad0390c6d739c39616cb6ece41e4521ce86d86a2c0d9dd7498b8f2349606afd43ba3448ae6f83f11625154f5e2d1324d54f07c9973bc83ac1fab2589774cab51acba9594196cde021ed57e690cd92f915d569100a9c6b9b986315428a781e07845acd5e5dd15b11e46a565c2e0219954088b0e903e265117985e9cfd30e676f71d7d72697c5b0dc45dd0a5ccea0bbbf0db66cd332dfd7c763dbfb27f4c727eb8b40fdc148a38a1e115913913430dbf3f9143831b4d393801b6d57ac5275ad484611ccf91cdf7f35afb7d86435e88137f9ff0cf35029a798b802086cd4f32f7cbdd2e7f12d752954c29cbe9bc35b27055d64e7c71f4e3266210fa1ad4bfd01f68bba24e6f8ae8e0213f2eefb395fee89674d05264fc90f7ceae4c5a180906ff662ed08777370ec90e7ec195052a05e606e91073c78fbe4a69d9c36361b822a6e71e0e605cc43df745ffd9d17f0a550db1e2cd51da355411d6037ffd7789195b95231d0dbda691171f83c4d9219582906fea808f5cab0457cae818ee1ad722218bcbb6f58fb3970783d504914a037610e73c36317e558999d31efd40476da35bb6937c525a085af0147335fdd0996794e7f4c3955cb79ad21b706157da3bb3676b80695705864d59d0468875ee1c808dc1ab25d8a22bd6b4634a44e4de90384115667656ee37b9a42a8a45cc1b211d22b1d00b2818800c684ccc7afbfb3094cda608115dc7809dd8476708214dfb3ce8d3595c681f33ab946c7520147dd6ea179990d330f06df8fea5a2463fc51500f9e387cea5dfe52361a');

	}
}

function setURL( shaderString ) {

	compressor.compress( shaderString, 1, function( bytes ) {

		var hex = convertBytesToHex( bytes );
		window.location.replace( '#A/' + hex );

	},
	dummyFunction );

}

function readURL( hash ) {

	var bytes = convertHexToBytes( hash );

	compressor.decompress( bytes, function( text ) {

		compileOnChangeCode = false;  // Prevent compile timer start
		code.setValue(text);
		compile();
		compileOnChangeCode = true;

	},
	dummyFunction );

}

function convertHexToBytes( text ) {

	var tmpHex, array = [];

	for ( var i = 0; i < text.length; i += 2 ) {

		tmpHex = text.substring( i, i + 2 );
		array.push( parseInt( tmpHex, 16 ) );

	}

	return array;

}

function convertBytesToHex( byteArray ) {

	var tmpHex, hex = "";

	for ( var i = 0, il = byteArray.length; i < il; i ++ ) {

		if ( byteArray[ i ] < 0 ) {

			byteArray[ i ] = byteArray[ i ] + 256;

		}

		tmpHex = byteArray[ i ].toString( 16 );

		// add leading zero

		if ( tmpHex.length == 1 ) tmpHex = "0" + tmpHex;

		hex += tmpHex;

	}

	return hex;

}

// dummy functions for saveButton
function set_save_button(visibility) {
}

function set_parent_button(visibility) {
}

function add_server_buttons() {
}

